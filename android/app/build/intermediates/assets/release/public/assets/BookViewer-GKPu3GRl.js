import{j as e,m as t}from"./framer--EiQgGdQ.js";import{r as s}from"./vendor-fbM9bkeS.js";import{c as n,g as a,L as l,a as o,X as i,A as r,I as c}from"./index-CGXY-R5d.js";import"./utils-DiRS1ToC.js";import"./supabase-DkUcngs9.js";import"./ui-Yji1MIDK.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d=n("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),u=n("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]),m=({book:n,onClose:m})=>{const[h,b]=s.useState(!1),[x,f]=s.useState(!0),[p,w]=s.useState(null),[v,g]=s.useState(null),y=s.useRef(null),j=s.useRef(null),[k,N]=s.useState(Date.now()),{goBack:C}=a(),E=()=>{N(Date.now())};s.useEffect((()=>{const e=e=>{"Escape"!==e.key||h||m()},t=()=>{b(!!document.fullscreenElement)},s=()=>{"visible"===document.visibilityState&&E()};window.Android&&window.Android.enableRotation(),window.addEventListener("keydown",e),document.addEventListener("fullscreenchange",t),document.addEventListener("visibilitychange",s);const a=setInterval((()=>{"visible"===document.visibilityState&&E()}),3e4);return(async()=>{try{f(!0),w(null);const t=c.getInstance();if(n.content_url.includes("ipfs.io")||n.content_url.includes("ipfs://")){const s=/ipfs(?::\/\/|\.io\/ipfs\/)([a-zA-Z0-9]+)/,a=n.content_url.match(s);if(a&&a[1]){const s=a[1];try{await t.getContent(s),g(t.getContentUrl(s))}catch(e){console.error("Failed to load book from IPFS:",e),g(n.content_url)}}else g(n.content_url)}else try{const e=t.getBookCid(n.id);e?(await t.getContent(e),g(t.getContentUrl(e))):(console.log("Book not found in IPFS registry, using original URL"),g(n.content_url))}catch(e){console.error("Failed to load book from IPFS by ID:",e),g(n.content_url)}}catch(e){console.error("Error loading book content:",e),w("Failed to load book content. Please try again.")}finally{f(!1)}})(),()=>{window.removeEventListener("keydown",e),document.removeEventListener("fullscreenchange",t),document.removeEventListener("visibilitychange",s),clearInterval(a),window.Android&&window.Android.disableRotation()}}),[m,h,n.content_url,n.id]);const L=()=>{C(),m()};return e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black z-50",ref:y,children:e.jsxs("div",{className:"w-full h-full relative",children:[x?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(l,{className:"w-12 h-12 text-white animate-spin mb-4"}),e.jsx("p",{className:"text-white",children:"Loading book content..."})]}):p?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(o,{className:"w-12 h-12 text-red-500 mb-4"}),e.jsx("p",{className:"text-white mb-4",children:p}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-primary-500 text-white rounded-lg",children:"Try Again"})]}):v?e.jsx("iframe",{ref:j,src:v,className:"w-full h-full border-none bg-white",title:n.title,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-modals",loading:"eager",allow:"fullscreen",importance:"high"},k):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(o,{className:"w-12 h-12 text-red-500 mb-4"}),e.jsx("p",{className:"text-white",children:"No content URL available for this book."})]}),e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2",children:[e.jsx("button",{onClick:async()=>{var e;try{h?await document.exitFullscreen():await(null==(e=y.current)?void 0:e.requestFullscreen())}catch(t){console.error("Fullscreen error:",t)}},className:"p-2 bg-black/20 hover:bg-black/30 rounded-full transition-colors",children:h?e.jsx(u,{size:24,className:"text-white"}):e.jsx(d,{size:24,className:"text-white"})}),!h&&e.jsx("button",{onClick:L,className:"p-2 bg-black/20 hover:bg-black/30 rounded-full transition-colors",children:e.jsx(i,{size:24,className:"text-white"})})]}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("button",{onClick:L,className:"p-2 bg-black/20 hover:bg-black/30 rounded-full transition-colors",children:e.jsx(r,{size:24,className:"text-white"})})})]})})};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{m as default};
