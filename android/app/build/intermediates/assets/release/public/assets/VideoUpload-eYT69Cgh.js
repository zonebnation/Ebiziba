import{j as e,m as r}from"./framer--EiQgGdQ.js";import{r as a}from"./vendor-fbM9bkeS.js";import{c as s,u as t,X as l,L as i,s as d}from"./index-CGXY-R5d.js";import{U as n}from"./upload-lX1edj6g.js";import"./utils-DiRS1ToC.js";import"./supabase-DkUcngs9.js";import"./ui-Yji1MIDK.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o=s("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),c=({onSuccess:s,onCancel:c})=>{const{user:u}=t(),[x,m]=a.useState(""),[g,b]=a.useState(""),[y,p]=a.useState(null),[h,f]=a.useState(null),[j,v]=a.useState(!1),[k,N]=a.useState(null),[w,C]=a.useState(0),P=a.useRef(null),M=a.useRef(null),S=async(e,r)=>{const a=e.name.split(".").pop(),s=`${Math.random().toString(36).slice(2)}.${a}`,t=`${null==u?void 0:u.id}/${s}`,{data:l,error:i}=await d.storage.from(r).upload(t,e,{upsert:!0,onUploadProgress:e=>{const r=e.loaded/e.total*100;C(r)}});if(i)throw i;const{data:{publicUrl:n}}=d.storage.from(r).getPublicUrl(t);return n};return e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Upload Video"}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(l,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),k&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-lg text-sm",children:k}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u)if(y&&h&&x.trim()&&g.trim())try{v(!0),N(null);const[e,r]=await Promise.all([S(y,"videos"),S(h,"thumbnails")]),{error:a}=await d.from("reels").insert({title:x,description:g,video_url:e,thumbnail_url:r,user_id:u.id});if(a)throw a;m(""),b(""),p(null),f(null),C(0),null==s||s()}catch(r){console.error("Error uploading video:",r),N("Failed to upload video. Please try again.")}finally{v(!1)}else N("Please fill in all required fields");else N("Please sign in to upload videos")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:x,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter video title",disabled:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:g,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter video description",rows:3,disabled:j})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:P,onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];a&&(a.type.startsWith("video/")?a.size>104857600?N("Video file size must be less than 100MB"):(p(a),N(null)):N("Please select a valid video file"))},accept:"video/*",className:"hidden",disabled:j}),e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=P.current)?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-lg flex flex-col items-center justify-center space-y-2 "+(y?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"),disabled:j,children:[e.jsx(n,{size:24,className:y?"text-green-500":"text-gray-400"}),e.jsx("div",{className:"text-sm text-center",children:y?e.jsx("span",{className:"text-green-500",children:y.name}):e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Click to upload video",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"MP4, WebM or OGG (Max 100MB)"})]})})]})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:M,onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];a&&(a.type.startsWith("image/")?a.size>2097152?N("Thumbnail image size must be less than 2MB"):(f(a),N(null)):N("Please select a valid image file for thumbnail"))},accept:"image/*",className:"hidden",disabled:j}),e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-lg flex flex-col items-center justify-center space-y-2 "+(h?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"),disabled:j,children:[e.jsx(o,{size:24,className:h?"text-green-500":"text-gray-400"}),e.jsx("div",{className:"text-sm text-center",children:h?e.jsx("span",{className:"text-green-500",children:h.name}):e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Click to upload thumbnail",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"JPG, PNG or GIF (Max 2MB)"})]})})]})]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${w}%`}})}),e.jsxs("p",{className:"text-sm text-center text-gray-500 dark:text-gray-400",children:["Uploading... ",Math.round(w),"%"]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j||!y||!h,className:"flex-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:j?e.jsx(i,{className:"w-5 h-5 animate-spin"}):"Upload"})]})]})]})})})};export{c as VideoUpload};
