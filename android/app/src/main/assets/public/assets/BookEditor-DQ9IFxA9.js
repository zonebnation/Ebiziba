import{j as e,m as r}from"./framer--EiQgGdQ.js";import{r as a}from"./vendor-fbM9bkeS.js";import{X as t,L as s,s as l}from"./index-CGXY-R5d.js";import{U as o}from"./upload-lX1edj6g.js";import"./utils-DiRS1ToC.js";import"./supabase-DkUcngs9.js";import"./ui-Yji1MIDK.js";const d=({book:d,onSave:i,onCancel:n})=>{const[c,u]=a.useState(d.title),[g,b]=a.useState(d.author),[x,m]=a.useState(d.description),[p,y]=a.useState(d.digital_price.toString()),[h,f]=a.useState(d.language),[j,v]=a.useState(null),[k,N]=a.useState(null),[w,C]=a.useState(!1),[S,P]=a.useState(null),[E,z]=a.useState(0),M=a.useRef(null),U=a.useRef(null),B=async(e,r)=>{const a=e.name.split(".").pop(),t=`${Math.random().toString(36).slice(2)}.${a}`,s=`${d.id}/${t}`,{data:o,error:i}=await l.storage.from(r).upload(s,e,{upsert:!0,onUploadProgress:e=>{const r=e.loaded/e.total*100;z(r)}});if(i)throw i;const{data:{publicUrl:n}}=l.storage.from(r).getPublicUrl(s);return n};return e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Edit Book"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(t,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),S&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-lg text-sm",children:S}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),c.trim()&&x.trim()&&p.trim())try{C(!0),P(null);let e={title:c,description:x,author:g,language:h,digital_price:parseInt(p)};j&&(e.cover_url=await B(j,"covers")),k&&(e.content_url=await B(k,"books"));const{data:r,error:a}=await l.from("books").update(e).eq("id",d.id).select().single();if(a)throw a;if(!r)throw new Error("No data returned from update");i(r)}catch(r){console.error("Error updating book:",r),P("Failed to update book")}finally{C(!1)}else P("Please fill in all required fields")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:c,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter book title",disabled:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Author"}),e.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter author name",disabled:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:x,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter book description",rows:3,disabled:w})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Price (UGX)"}),e.jsx("input",{type:"number",value:p,onChange:e=>y(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",placeholder:"Enter price",disabled:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Language"}),e.jsxs("select",{value:h,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 focus:outline-none focus:border-primary-500 dark:focus:border-primary-500 bg-white dark:bg-gray-800",disabled:w,children:[e.jsx("option",{value:"Luganda",children:"Luganda"}),e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Arabic",children:"Arabic"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:M,onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];a&&(a.type.startsWith("image/")?a.size>2097152?P("Cover image size must be less than 2MB"):(v(a),P(null)):P("Please select a valid image file for cover"))},accept:"image/*",className:"hidden",disabled:w}),e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-lg flex flex-col items-center justify-center space-y-2 border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",disabled:w,children:[e.jsx(o,{size:24,className:"text-gray-400"}),e.jsxs("div",{className:"text-sm text-center text-gray-500 dark:text-gray-400",children:["Click to upload new cover image",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Optional - JPG, PNG or GIF (Max 2MB)"})]})]})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:U,onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];a&&("application/pdf"===a.type?a.size>52428800?P("Content file size must be less than 50MB"):(N(a),P(null)):P("Please select a PDF file for content"))},accept:".pdf",className:"hidden",disabled:w}),e.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=U.current)?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-lg flex flex-col items-center justify-center space-y-2 border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",disabled:w,children:[e.jsx(o,{size:24,className:"text-gray-400"}),e.jsxs("div",{className:"text-sm text-center text-gray-500 dark:text-gray-400",children:["Click to upload new book content",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Optional - PDF only (Max 50MB)"})]})]})]})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${E}%`}})}),e.jsxs("p",{className:"text-sm text-center text-gray-500 dark:text-gray-400",children:["Uploading... ",Math.round(E),"%"]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:w,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"flex-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:w?e.jsx(s,{className:"w-5 h-5 animate-spin"}):"Save Changes"})]})]})]})})})};export{d as BookEditor};
